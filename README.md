# LuckinHappy Card Verification System

> A powerful, secure, and reliable card verification system built with modern TypeScript + Node.js stack

[![TypeScript](https://img.shields.io/badge/TypeScript-5.3+-blue.svg)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![SQLite](https://img.shields.io/badge/SQLite-3-orange.svg)](https://www.sqlite.org/)
[![License](https://img.shields.io/github/license/gaofee/luckinhappykami)](https://github.com/gaofee/luckinhappykami/blob/main/LICENSE)

## üìã È°πÁõÆÁÆÄ‰ªã

**LuckinHappyÂç°ÂØÜÈ™åËØÅÁ≥ªÁªü** ÊòØ‰∏Ä‰∏™ÂäüËÉΩÂº∫Â§ß„ÄÅÂÆâÂÖ®ÂèØÈù†ÁöÑÂç°ÂØÜÈ™åËØÅËß£ÂÜ≥ÊñπÊ°àÔºå‰∏ì‰∏∫ËΩØ‰ª∂ÂºÄÂèëËÄÖ„ÄÅÊ∏∏ÊàèÂºÄÂèëËÄÖ‰ª•ÂèäÈúÄË¶ÅÊï∞Â≠óÂïÜÂìÅÈ™åËØÅÊúçÂä°ÁöÑ‰ºÅ‰∏öÊâìÈÄ†„ÄÇ

### üéØ Ê†∏ÂøÉÂäüËÉΩ
- **Âç°ÂØÜÁîüÊàê‰∏éÁÆ°ÁêÜ**ÔºöÊâπÈáèÁîüÊàê„ÄÅÂØºÂÖ•ÂØºÂá∫„ÄÅÁä∂ÊÄÅÁÆ°ÁêÜ
- **ÂÆûÊó∂È™åËØÅ**ÔºöÊîØÊåÅÂ§öÁßçÈ™åËØÅÊñπÂºèÔºàÊó∂Èó¥Âç°„ÄÅÊ¨°Êï∞Âç°Ôºâ
- **ËÆæÂ§áÁªëÂÆö**ÔºöÈò≤Ê≠¢Âç°ÂØÜË¢´ÁõóÁî®ÂíåÊª•Áî®
- **Â§öAPIÊîØÊåÅ**Ôºö‰∏∫‰∏çÂêåÂ∫îÁî®Êèê‰æõÁã¨Á´ãÁöÑAPIÂØÜÈí•
- **ÁªüËÆ°ÂàÜÊûê**ÔºöËØ¶ÁªÜÁöÑ‰ΩøÁî®ÁªüËÆ°ÂíåÊï∞ÊçÆÂàÜÊûê
- **ÁÆ°ÁêÜÂêéÂè∞**ÔºöÁõ¥ËßÇÁöÑWebÁÆ°ÁêÜÁïåÈù¢

### üí° Â∫îÁî®Âú∫ÊôØ
- ËΩØ‰ª∂ÊøÄÊ¥ªÈ™åËØÅ
- Ê∏∏ÊàèÂÖÖÂÄºÂç°È™åËØÅ
- ‰ºöÂëòÊúçÂä°È™åËØÅ
- Êï∞Â≠óÂïÜÂìÅÈîÄÂîÆ
- SaaSÊúçÂä°ËÆ¢ÈòÖÈ™åËØÅ
- ‰ºÅ‰∏öÂÜÖÈÉ®ÊéàÊùÉÁÆ°ÁêÜ

### üåü Ê†∏ÂøÉ‰ºòÂäø
- **È´òÂÆâÂÖ®ÊÄß**ÔºöbcryptÂä†ÂØÜ + JWTËÆ§ËØÅ + ËÆæÂ§áÁªëÂÆö
- **È´òÊÄßËÉΩ**ÔºöÂºÇÊ≠•Â§ÑÁêÜ + Êï∞ÊçÆÂ∫ì‰ºòÂåñ + ÁºìÂ≠òÁ≠ñÁï•
- **ÊòìÈÉ®ÁΩ≤**Ôºö‰∏ÄÈîÆÂÆâË£ÖËÑöÊú¨ + ËØ¶ÁªÜÈÉ®ÁΩ≤ÊñáÊ°£
- **ÊòìÁª¥Êä§**ÔºöÁé∞‰ª£ÂåñÊäÄÊúØÊ†à + ÂÆåÊï¥ÊµãËØïË¶ÜÁõñ
- **ÊòìÊâ©Â±ï**ÔºöÊ®°ÂùóÂåñËÆæËÆ° + RESTful API

### ‚ö†Ô∏è ÈáçË¶ÅÂ£∞Êòé
**Êú¨È°πÁõÆ‰ªÖÁî®‰∫éÂ≠¶‰π†„ÄÅÁ†îÁ©∂ÂíåÂêàÊ≥ïÂïÜ‰∏öÁî®ÈÄî„ÄÇ‰∏•Á¶ÅÁî®‰∫é‰ªª‰ΩïËøùÊ≥ïËøùËßÑÊ¥ªÂä®ÔºåÂåÖÊã¨‰ΩÜ‰∏çÈôê‰∫éÔºö**
- ÁõóÁâàËΩØ‰ª∂ÂàÜÂèë
- ÈùûÊ≥ïÊï∞Â≠óÂïÜÂìÅÈîÄÂîÆ
- ‰æµÁäØÁü•ËØÜ‰∫ßÊùÉË°å‰∏∫
- ‰ªª‰ΩïËøùÂèçÊ≥ïÂæãÊ≥ïËßÑÁöÑÊ¥ªÂä®

**‰ΩøÁî®ËÄÖÈúÄËá™Ë°åÊâøÊãÖ‰ΩøÁî®Êú¨È°πÁõÆÁöÑÊ≥ïÂæãË¥£‰ªª„ÄÇ**

---

## üöÄ Âø´ÈÄüÂºÄÂßã

#### ÈÄâÈ°π1ÔºöËá™Âä®ÂåñÂÆâË£ÖÔºàÊé®ËçêÔºâ

‰∏∫‰∫ÜËé∑ÂæóÊúÄÁÆÄÂçïÁöÑËÆæÁΩÆ‰ΩìÈ™åÔºåËØ∑‰ΩøÁî®Êàë‰ª¨ÁöÑËá™Âä®ÂåñÂÆâË£ÖËÑöÊú¨Ôºö

```bash
# 1. ‰∏ãËΩΩÊàñÂÖãÈöÜÈ°πÁõÆ
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami

# 2. ËøêË°åÂÆâË£ÖËÑöÊú¨
./install.sh
```

ËØ•ËÑöÊú¨Â∞ÜËá™Âä®ÊâßË°åÔºö
- ‚úÖ Ê£ÄÊü•Á≥ªÁªüË¶ÅÊ±Ç
- ‚úÖ Ëá™Âä®ÂÆâË£Ö‰æùËµñ
- ‚úÖ ÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè
- ‚úÖ ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì
- ‚úÖ ÊûÑÂª∫Â∫îÁî®Á®ãÂ∫è
- ‚úÖ ËÆæÁΩÆPM2ËøõÁ®ãÁÆ°ÁêÜÂô®ÔºàÂèØÈÄâÔºâ
- ‚úÖ ÂàõÂª∫ÂêØÂä®ËÑöÊú¨

#### ÈÄâÈ°π2ÔºöÊâãÂä®ÂÆâË£Ö

Â¶ÇÊûúÊÇ®ÂÅèÂ•ΩÊâãÂä®ÂÆâË£ÖÔºö

##### ÁéØÂ¢ÉË¶ÅÊ±Ç
```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

##### ÂÆâË£ÖÊ≠•È™§

1. ÂÖãÈöÜÈ°πÁõÆ
```bash
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. ÂÆâË£Ö‰æùËµñ
```bash
npm install
```

3. ÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè
```bash
cp .env.example .env
# ÁºñËæë .env Êñá‰ª∂ÔºåÈÖçÁΩÆÊï∞ÊçÆÂ∫ìË∑ØÂæÑÂíåÂÖ∂‰ªñËÆæÁΩÆ
```

4. ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì
```bash
npm run init-db
```

5. ÂêØÂä®ÂºÄÂèëÊúçÂä°Âô®
```bash
npm run dev
```

6. ËÆøÈóÆÂ∫îÁî®
```
http://localhost:3000
```

---

## üöÄ ÂÆùÂ°îÈù¢ÊùøÈÉ®ÁΩ≤ÊåáÂçó

### ÂâçÁΩÆË¶ÅÊ±Ç
- Â∑≤ÂÆâË£ÖÂÆùÂ°îÈù¢ÊùøÁöÑÊúçÂä°Âô®
- ÂüüÂêçÔºàÂèØÈÄâÔºâ
- SSHËÆøÈóÆÊùÉÈôê

### Á¨¨‰∏ÄÊ≠•ÔºöÊúçÂä°Âô®ÂáÜÂ§á
1. ÁôªÂΩïÂÆùÂ°îÈù¢Êùø
2. ËøõÂÖ•"ËΩØ‰ª∂ÂïÜÂ∫ó" ‚Üí "ËøêË°åÁéØÂ¢É"
3. ÂÆâË£Ö Node.js 18+ Âíå PM2
4. ÂÆâË£Ö NginxÔºàÂ¶ÇÊú™ÂÆâË£ÖÔºâ

### Á¨¨‰∫åÊ≠•Ôºö‰ª£Á†ÅÈÉ®ÁΩ≤
1. ÈÄöËøáFTP‰∏ä‰º†È°πÁõÆÊñá‰ª∂Êàñ‰ΩøÁî®gitÂÖãÈöÜ
```bash
cd /www/wwwroot
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. ÂÆâË£Ö‰æùËµñ
```bash
npm install
```

3. ÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè
```bash
cp .env.example .env
# ÁºñËæë .env Êñá‰ª∂ÈÖçÁΩÆÊÇ®ÁöÑËÆæÁΩÆ
```

4. ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì
```bash
npm run init-db
```

5. ÊûÑÂª∫Â∫îÁî®
```bash
npm run build
```

### Á¨¨‰∏âÊ≠•ÔºöPM2ËøõÁ®ãÁÆ°ÁêÜ
1. ÂÆâË£ÖPM2ÔºàÂ¶ÇÂÆùÂ°îÊú™ÂÆâË£ÖÔºâ
```bash
npm install -g pm2
```

2. ÂàõÂª∫PM2ÈÖçÁΩÆÊñá‰ª∂ `ecosystem.config.js`
```javascript
module.exports = {
  apps: [{
    name: 'luckinhappykami',
    script: 'dist/server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    }
  }]
};
```

3. ‰ΩøÁî®PM2ÂêØÂä®Â∫îÁî®
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### Á¨¨ÂõõÊ≠•ÔºöNginxÈÖçÁΩÆ
1. Âú®ÂÆùÂ°îÈù¢ÊùøËøõÂÖ•"ÁΩëÁ´ô" ‚Üí "ËÆæÁΩÆ"
2. Ê∑ªÂä†ÁΩëÁ´ôÈÖçÁΩÆÊàñ‰øÆÊîπÁé∞ÊúâÈÖçÁΩÆ
3. ÈÖçÁΩÆÂèçÂêë‰ª£ÁêÜÔºö

```
# NginxÈÖçÁΩÆ
server {
    listen 80;
    server_name your-domain.com;
    root /www/wwwroot/luckinhappykami/dist/public;
    index index.html;

    # ÂâçÁ´ØË∑ØÁî±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API‰ª£ÁêÜ
    location /api {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ÈùôÊÄÅÊñá‰ª∂
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

4. SSLËØÅ‰π¶ÈÖçÁΩÆÔºàÊé®ËçêÔºâ
   - Âú®ÂÆùÂ°îÈù¢ÊùøËøõÂÖ•"SSL" ‚Üí "Let's Encrypt"
   - Áî≥ËØ∑ÂÖçË¥πSSLËØÅ‰π¶

### Á¨¨‰∫îÊ≠•ÔºöÊï∞ÊçÆÂ∫ìÂíåÊñá‰ª∂ÊùÉÈôê
1. Á°Æ‰øùSQLiteÊï∞ÊçÆÂ∫ìÊñá‰ª∂ÊùÉÈôêÊ≠£Á°Æ
```bash
chmod 644 data/luckinhappykami.db
```

2. Á°Æ‰øù‰∏ä‰º†ÁõÆÂΩïÊúâÂÜôÂÖ•ÊùÉÈôê
```bash
chmod 755 uploads
```

### Á¨¨ÂÖ≠Ê≠•ÔºöÈò≤ÁÅ´Â¢ôÈÖçÁΩÆ
1. Âú®ÂÆùÂ°îÈù¢ÊùøËøõÂÖ•"ÂÆâÂÖ®" ‚Üí "Èò≤ÁÅ´Â¢ô"
2. ÂºÄÊîæ80„ÄÅ443Á´ØÂè£ÔºàHTTP/HTTPSÔºâ
3. Á°Æ‰øù3001Á´ØÂè£‰ªÖÊú¨Âú∞ËÆøÈóÆ

### Á¨¨‰∏ÉÊ≠•ÔºöÂ§á‰ªΩÈÖçÁΩÆ
1. ËÆæÁΩÆÂÆöÊúüÊï∞ÊçÆÂ∫ìÂ§á‰ªΩ
2. ÈÖçÁΩÆÊó•ÂøóËΩÆËΩ¨
3. ËÆæÁΩÆÁõëÊéßÂëäË≠¶

### Á¨¨ÂÖ´Ê≠•ÔºöÊµãËØïÈ™åËØÅ
1. ËÆøÈóÆÂüüÂêçÔºö`http://your-domain.com`
2. ÊµãËØïAPIÊé•Âè£
3. ËøêË°åÊµãËØïËÑöÊú¨È™åËØÅÂäüËÉΩ

### ÊïÖÈöúÊéíÈô§
- **Á´ØÂè£ÂÜ≤Á™Å**ÔºöÊ£ÄÊü•80„ÄÅ443„ÄÅ3001Á´ØÂè£ÊòØÂê¶ÂèØÁî®
- **ÊùÉÈôêÈóÆÈ¢ò**ÔºöÁ°Æ‰øùÊñá‰ª∂ÊùÉÈôêÊ≠£Á°Æ
- **Êï∞ÊçÆÂ∫ìÈîôËØØ**ÔºöÊ£ÄÊü•Êï∞ÊçÆÂ∫ìÊñá‰ª∂Ë∑ØÂæÑÂíåÊùÉÈôê
- **ÂÜÖÂ≠òÈóÆÈ¢ò**ÔºöÁõëÊéßPM2Êó•ÂøóÂπ∂Ë∞ÉÊï¥ÂÜÖÂ≠òÈôêÂà∂

---

## English Documentation

### ‚ú® Features

#### üõ°Ô∏è Security & Reliability
- bcrypt password encryption storage
- JWT authentication
- Device binding mechanism
- Anti-brute force protection
- Multi-layer security verification
- SHA1 encrypted card key storage

#### üîå API Support
- RESTful API interface
- Multi-API key management
- API call statistics
- Detailed API documentation
- Support POST/GET verification
- Device ID binding mechanism

#### ‚ö° High Performance & Stability
- TypeScript type safety
- High-performance SQLite database
- Fast response speed
- Stable operation performance
- Modern asynchronous processing

#### üìä Data Statistics
- Real-time statistics
- Detailed data analysis
- Visual chart display
- API call statistics
- Complete usage records

### ‚ö†Ô∏è Important Disclaimer
**This project is intended for educational, research, and legitimate commercial purposes only. It is strictly prohibited for any illegal or unlawful activities, including but not limited to:**
- Pirated software distribution
- Illegal digital goods sales
- Intellectual property infringement
- Any activities that violate laws and regulations

**Users are solely responsible for the legal consequences of using this project.**

### üöÄ Quick Start

#### Option 1: Automated Installation (Recommended)

For the easiest setup experience, use our automated installation script:

```bash
# 1. Download or clone the project
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami

# 2. Run the installation script
./install.sh
```

The script will:
- ‚úÖ Check system requirements
- ‚úÖ Install dependencies automatically
- ‚úÖ Configure environment variables
- ‚úÖ Initialize the database
- ‚úÖ Build the application
- ‚úÖ Set up PM2 process manager (optional)
- ‚úÖ Create startup scripts

#### Option 2: Manual Installation

If you prefer manual installation:

##### Environment Requirements
```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

##### Installation Steps

1. Clone the project
```bash
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. Install dependencies
```bash
npm install
```

3. Configure environment variables
```bash
cp .env.example .env
# Edit .env file to configure database path and other settings
```

4. Initialize database
```bash
npm run init-db
```

5. Start development server
```bash
npm run dev
```

6. Access the application
```
http://localhost:3000
```

### üìö API Documentation

#### Card Verification API

##### POST /api/verify
Verify card key and perform device binding

**Request Parameters:**
```json
{
  "card_key": "card secret key",
  "device_id": "device unique identifier"
}
```

**Response Example:**
```json
{
  "code": 0,
  "message": "Verification successful",
  "data": {
    "card_key": "xxx",
    "status": 1,
    "use_time": "2024-01-01 12:00:00",
    "expire_time": "2024-01-31 12:00:00",
    "card_type": "time",
    "duration": 30,
    "device_id": "device123",
    "allow_reverify": true
  }
}
```

##### GET /api/verify (Alternative)
```
GET /api/verify?api_key=your-api-key&card_key=xxx&device_id=device123
```

#### Admin APIs

##### POST /admin/login
Admin login

##### GET /admin/cards
Get card list

##### POST /admin/cards/generate
Batch generate cards

### üîß Tech Stack

- **Backend Framework**: Express.js
- **Programming Language**: TypeScript
- **Database**: SQLite3
- **Authentication**: JWT + bcrypt
- **Template Engine**: EJS
- **Frontend Styling**: Modern CSS
- **Build Tool**: TypeScript Compiler
- **Code Quality**: ESLint + Prettier

### üîí Security Features

- **Password Security**: bcrypt hashing algorithm
- **Authentication**: JWT token mechanism
- **Input Validation**: Comprehensive input sanitization
- **SQL Injection Protection**: Parameterized queries
- **XSS Protection**: Content escaping and CSP headers

### üìä Performance Optimization

- **Database Optimization**: Smart query merging and index usage
- **Cache Strategy**: Static resource caching and preloading
- **Asynchronous Processing**: Full utilization of Node.js async features
- **Memory Management**: Efficient memory usage and garbage collection
- **Response Compression**: Gzip compression to reduce transmission size

### üöÄ Baota Deployment Guide

#### Prerequisites
- Server with Baota panel installed
- Domain name (optional)
- SSH access

#### Step 1: Server Preparation
1. Log into Baota panel
2. Go to "Software Store" ‚Üí "Runtime Environment"
3. Install Node.js 18+ and PM2
4. Install Nginx (if not already installed)

#### Step 2: Code Deployment
1. Upload project files to server via FTP or git clone
```bash
cd /www/wwwroot
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. Install dependencies
```bash
npm install
```

3. Configure environment variables
```bash
cp .env.example .env
# Edit .env file with your configuration
```

4. Initialize database
```bash
npm run init-db
```

5. Build the application
```bash
npm run build
```

#### Step 3: PM2 Process Management
1. Install PM2 (if not already done via Baota)
```bash
npm install -g pm2
```

2. Create PM2 configuration file `ecosystem.config.js`
```javascript
module.exports = {
  apps: [{
    name: 'luckinhappykami',
    script: 'dist/server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    }
  }]
};
```

3. Start the application with PM2
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### Step 4: Nginx Configuration
1. In Baota panel, go to "Website" ‚Üí "Settings"
2. Add website configuration or modify existing one
3. Configure reverse proxy:

```
# Nginx Configuration
server {
    listen 80;
    server_name your-domain.com;
    root /www/wwwroot/luckinhappykami/dist/public;
    index index.html;

    # Frontend routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy
    location /api {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Static files
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

4. SSL certificate configuration (recommended)
   - In Baota panel, go to "SSL" ‚Üí "Let's Encrypt"
   - Apply for free SSL certificate

#### Step 5: Database and File Permissions
1. Ensure SQLite database file has correct permissions
```bash
chmod 644 data/luckinhappykami.db
```

2. Ensure uploads directory has write permissions
```bash
chmod 755 uploads
```

#### Step 6: Firewall Configuration
1. In Baota panel, go to "Security" ‚Üí "Firewall"
2. Open ports 80, 443 (HTTP/HTTPS)
3. Ensure port 3001 is only accessible locally

#### Step 7: Backup Configuration
1. Set up regular database backups
2. Configure log rotation
3. Set up monitoring alerts

#### Step 8: Testing
1. Access your domain: `http://your-domain.com`
2. Test API endpoints
3. Run the test scripts to verify functionality

#### Troubleshooting
- **Port conflicts**: Check if ports 80, 443, 3001 are available
- **Permission issues**: Ensure proper file permissions
- **Database errors**: Check database file path and permissions
- **Memory issues**: Monitor PM2 logs and adjust memory limits

### ü§ù Contributing

1. Fork the repository
2. Create feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Submit Pull Request

### üìÑ License

This project is licensed under the MIT License. See [LICENSE](LICENSE) file for details.

### ‚≠ê Acknowledgments

Special thanks to the original project:
- **[xiaoxiaoguai-yyds/xxgkami](https://github.com/xiaoxiaoguai-yyds/xxgkami)** - Original PHP implementation that inspired this TypeScript rewrite

Thanks to all developers who contributed to this project!

---

**Note**: This project is a complete TypeScript rewrite of the original PHP version, providing better type safety, performance, and development experience.
