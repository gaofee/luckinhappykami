# LuckinHappy Card Verification System

> A powerful, secure, and reliable card verification system built with modern TypeScript + Node.js stack

[![TypeScript](https://img.shields.io/badge/TypeScript-5.3+-blue.svg)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![SQLite](https://img.shields.io/badge/SQLite-3-orange.svg)](https://www.sqlite.org/)
[![License](https://img.shields.io/github/license/gaofee/luckinhappykami)](https://github.com/gaofee/luckinhappykami/blob/main/LICENSE)

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

**LuckinHappyå¡å¯†éªŒè¯ç³»ç»Ÿ** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€å®‰å…¨å¯é çš„å¡å¯†éªŒè¯è§£å†³æ–¹æ¡ˆï¼Œä¸“ä¸ºè½¯ä»¶å¼€å‘è€…ã€æ¸¸æˆå¼€å‘è€…ä»¥åŠéœ€è¦æ•°å­—å•†å“éªŒè¯æœåŠ¡çš„ä¼ä¸šæ‰“é€ ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **å¡å¯†ç”Ÿæˆä¸ç®¡ç†**ï¼šæ‰¹é‡ç”Ÿæˆã€å¯¼å…¥å¯¼å‡ºã€çŠ¶æ€ç®¡ç†
- **å®æ—¶éªŒè¯**ï¼šæ”¯æŒå¤šç§éªŒè¯æ–¹å¼ï¼ˆæ—¶é—´å¡ã€æ¬¡æ•°å¡ï¼‰
- **è®¾å¤‡ç»‘å®š**ï¼šé˜²æ­¢å¡å¯†è¢«ç›—ç”¨å’Œæ»¥ç”¨
- **å¤šAPIæ”¯æŒ**ï¼šä¸ºä¸åŒåº”ç”¨æä¾›ç‹¬ç«‹çš„APIå¯†é’¥
- **ç»Ÿè®¡åˆ†æ**ï¼šè¯¦ç»†çš„ä½¿ç”¨ç»Ÿè®¡å’Œæ•°æ®åˆ†æ
- **ç®¡ç†åå°**ï¼šç›´è§‚çš„Webç®¡ç†ç•Œé¢

### ğŸ’¡ åº”ç”¨åœºæ™¯
- è½¯ä»¶æ¿€æ´»éªŒè¯
- æ¸¸æˆå……å€¼å¡éªŒè¯
- ä¼šå‘˜æœåŠ¡éªŒè¯
- æ•°å­—å•†å“é”€å”®
- SaaSæœåŠ¡è®¢é˜…éªŒè¯
- ä¼ä¸šå†…éƒ¨æˆæƒç®¡ç†

### ğŸŒŸ æ ¸å¿ƒä¼˜åŠ¿
- **é«˜å®‰å…¨æ€§**ï¼šbcryptåŠ å¯† + JWTè®¤è¯ + è®¾å¤‡ç»‘å®š
- **é«˜æ€§èƒ½**ï¼šå¼‚æ­¥å¤„ç† + æ•°æ®åº“ä¼˜åŒ– + ç¼“å­˜ç­–ç•¥
- **æ˜“éƒ¨ç½²**ï¼šä¸€é”®å®‰è£…è„šæœ¬ + è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- **æ˜“ç»´æŠ¤**ï¼šç°ä»£åŒ–æŠ€æœ¯æ ˆ + å®Œæ•´æµ‹è¯•è¦†ç›–
- **æ˜“æ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ + RESTful API

### âš ï¸ é‡è¦å£°æ˜
**æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ ã€ç ”ç©¶å’Œåˆæ³•å•†ä¸šç”¨é€”ã€‚ä¸¥ç¦ç”¨äºä»»ä½•è¿æ³•è¿è§„æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š**
- ç›—ç‰ˆè½¯ä»¶åˆ†å‘
- éæ³•æ•°å­—å•†å“é”€å”®
- ä¾µçŠ¯çŸ¥è¯†äº§æƒè¡Œä¸º
- ä»»ä½•è¿åæ³•å¾‹æ³•è§„çš„æ´»åŠ¨

**ä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨æœ¬é¡¹ç›®çš„æ³•å¾‹è´£ä»»ã€‚**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

#### é€‰é¡¹1ï¼šè‡ªåŠ¨åŒ–å®‰è£…ï¼ˆæ¨èï¼‰

ä¸ºäº†è·å¾—æœ€ç®€å•çš„è®¾ç½®ä½“éªŒï¼Œè¯·ä½¿ç”¨æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼š

```bash
# 1. ä¸‹è½½æˆ–å…‹éš†é¡¹ç›®
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami

# 2. è¿è¡Œå®‰è£…è„šæœ¬
./install.sh
```

è¯¥è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œï¼š
- âœ… æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
- âœ… è‡ªåŠ¨å®‰è£…ä¾èµ–
- âœ… é…ç½®ç¯å¢ƒå˜é‡
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… æ„å»ºåº”ç”¨ç¨‹åº
- âœ… è®¾ç½®PM2è¿›ç¨‹ç®¡ç†å™¨ï¼ˆå¯é€‰ï¼‰
- âœ… åˆ›å»ºå¯åŠ¨è„šæœ¬

#### é€‰é¡¹2ï¼šæ‰‹åŠ¨å®‰è£…

å¦‚æœæ‚¨åå¥½æ‰‹åŠ¨å®‰è£…ï¼š

##### ç¯å¢ƒè¦æ±‚
```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

##### å®‰è£…æ­¥éª¤

1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è·¯å¾„å’Œå…¶ä»–è®¾ç½®
```

4. åˆå§‹åŒ–æ•°æ®åº“
```bash
npm run init-db
```

5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

6. è®¿é—®åº”ç”¨
```
http://localhost:3000
```



---

## English

### âœ¨ Features

#### ğŸ›¡ï¸ Security & Reliability
- bcrypt password encryption storage
- JWT authentication
- Device binding mechanism
- Anti-brute force protection
- Multi-layer security verification
- SHA1 encrypted card key storage

#### ğŸ”Œ API Support
- RESTful API interface
- Multi-API key management
- API call statistics
- Detailed API documentation
- Support POST/GET verification
- Device ID binding mechanism

#### âš¡ High Performance & Stability
- TypeScript type safety
- High-performance SQLite database
- Fast response speed
- Stable operation performance
- Modern asynchronous processing

#### ğŸ“Š Data Statistics
- Real-time statistics
- Detailed data analysis
- Visual chart display
- API call statistics
- Complete usage records

### âš ï¸ Important Disclaimer
**This project is intended for educational, research, and legitimate commercial purposes only. It is strictly prohibited for any illegal or unlawful activities, including but not limited to:**
- Pirated software distribution
- Illegal digital goods sales
- Intellectual property infringement
- Any activities that violate laws and regulations

**Users are solely responsible for the legal consequences of using this project.**

### ğŸš€ Quick Start

#### Option 1: Automated Installation (Recommended)

For the easiest setup experience, use our automated installation script:

```bash
# 1. Download or clone the project
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami

# 2. Run the installation script
./install.sh
```

The script will:
- âœ… Check system requirements
- âœ… Install dependencies automatically
- âœ… Configure environment variables
- âœ… Initialize the database
- âœ… Build the application
- âœ… Set up PM2 process manager (optional)
- âœ… Create startup scripts

#### Option 2: Manual Installation

If you prefer manual installation:

##### Environment Requirements
```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

##### Installation Steps

1. Clone the project
```bash
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. Install dependencies
```bash
npm install
```

3. Configure environment variables
```bash
cp .env.example .env
# Edit .env file to configure database path and other settings
```

4. Initialize database
```bash
npm run init-db
```

5. Start development server
```bash
npm run dev
```

6. Access the application
```
http://localhost:3000
```

### ğŸ“š API Documentation

#### Card Verification API

##### POST /api/verify
Verify card key and perform device binding

**Request Parameters:**
```json
{
  "card_key": "card secret key",
  "device_id": "device unique identifier"
}
```

**Response Example:**
```json
{
  "code": 0,
  "message": "Verification successful",
  "data": {
    "card_key": "xxx",
    "status": 1,
    "use_time": "2024-01-01 12:00:00",
    "expire_time": "2024-01-31 12:00:00",
    "card_type": "time",
    "duration": 30,
    "device_id": "device123",
    "allow_reverify": true
  }
}
```

##### GET /api/verify (Alternative)
```
GET /api/verify?api_key=your-api-key&card_key=xxx&device_id=device123
```

#### Admin APIs

##### POST /admin/login
Admin login

##### GET /admin/cards
Get card list

##### POST /admin/cards/generate
Batch generate cards

###  Project Structure

```
luckinhappykami/
â”œâ”€â”€ src/                          # Backend code
â”‚   â”œâ”€â”€ config/                   # Configuration management
â”‚   â”œâ”€â”€ controllers/              # API controllers
â”‚   â”œâ”€â”€ database/                 # Database related
â”‚   â”œâ”€â”€ middleware/               # Middleware
â”‚   â”œâ”€â”€ routes/                   # Route definitions
â”‚   â”œâ”€â”€ services/                 # Business logic services
â”‚   â”œâ”€â”€ types/                    # TypeScript type definitions
â”‚   â”œâ”€â”€ utils/                    # Utility functions
â”‚   â”œâ”€â”€ public/                   # Static resources
â”‚   â”œâ”€â”€ views/                    # Template files (dev use)
â”‚   â””â”€â”€ server.ts                 # Application entry
â”œâ”€â”€ frontend/                     # Frontend Vue.js application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/           # Vue components
â”‚   â”‚   â”œâ”€â”€ views/                # Page components
â”‚   â”‚   â”œâ”€â”€ router/               # Route configuration
â”‚   â”‚   â”œâ”€â”€ stores/               # Pinia state management
â”‚   â”‚   â”œâ”€â”€ utils/                # Frontend utilities
â”‚   â”‚   â””â”€â”€ types/                # Frontend type definitions
â”‚   â”œâ”€â”€ public/                   # Frontend static resources
â”‚   â”œâ”€â”€ index.html                # Frontend entry HTML
â”‚   â”œâ”€â”€ vite.config.ts            # Vite configuration
â”‚   â””â”€â”€ package.json              # Frontend dependencies
â”œâ”€â”€ data/                         # SQLite database files
â”œâ”€â”€ uploads/                      # Upload file directory
â”œâ”€â”€ dist/                         # Build output directory
â”œâ”€â”€ .env                          # Environment configuration
â”œâ”€â”€ package.json                  # Main project configuration
â”œâ”€â”€ tsconfig.json                 # TypeScript configuration
â””â”€â”€ README.md
```

### ğŸ› ï¸ Available Scripts

```bash
# Start in development mode
npm run dev

# Build production version
npm run build

# Start production version
npm start

# Initialize database
npm run init-db

# Run tests
npm test

# Code linting
npm run lint

# Code formatting
npm run format
```

### ğŸ“š API Documentation

#### Card Verification API

##### POST /api/verify
Verify card key and perform device binding

**Request Parameters:**
```json
{
  "card_key": "card secret key",
  "device_id": "device unique identifier"
}
```

**Response Example:**
```json
{
  "code": 0,
  "message": "Verification successful",
  "data": {
    "card_key": "xxx",
    "status": 1,
    "use_time": "2024-01-01 12:00:00",
    "expire_time": "2024-01-31 12:00:00",
    "card_type": "time",
    "duration": 30,
    "device_id": "device123",
    "allow_reverify": true
  }
}
```

#### Admin APIs

##### POST /admin/login
Admin login

##### GET /admin/cards
Get card list

##### POST /admin/cards/generate
Batch generate cards

### ğŸ”§ Tech Stack

- **Backend Framework**: Express.js
- **Programming Language**: TypeScript
- **Database**: SQLite3
- **Authentication**: JWT + bcrypt
- **Template Engine**: EJS
- **Frontend Styling**: Modern CSS
- **Build Tool**: TypeScript Compiler
- **Code Quality**: ESLint + Prettier

### ğŸ”’ Security Features

- **Password Security**: bcrypt hashing algorithm
- **Authentication**: JWT token mechanism
- **Input Validation**: Comprehensive input sanitization
- **SQL Injection Protection**: Parameterized queries
- **XSS Protection**: Content escaping and CSP headers

### ğŸ“Š Performance Optimization

- **Database Optimization**: Smart query merging and index usage
- **Cache Strategy**: Static resource caching and preloading
- **Asynchronous Processing**: Full utilization of Node.js async features
- **Memory Management**: Efficient memory usage and garbage collection
- **Response Compression**: Gzip compression to reduce transmission size

### ğŸš€ Baota Deployment Guide

#### Prerequisites
- Server with Baota panel installed
- Domain name (optional)
- SSH access

#### Step 1: Server Preparation
1. Log into Baota panel
2. Go to "Software Store" â†’ "Runtime Environment"
3. Install Node.js 18+ and PM2
4. Install Nginx (if not already installed)

#### Step 2: Code Deployment
1. Upload project files to server via FTP or git clone
```bash
cd /www/wwwroot
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. Install dependencies
```bash
npm install
```

3. Configure environment variables
```bash
cp .env.example .env
# Edit .env file with your configuration
```

4. Initialize database
```bash
npm run init-db
```

5. Build the application
```bash
npm run build
```

#### Step 3: PM2 Process Management
1. Install PM2 (if not already done via Baota)
```bash
npm install -g pm2
```

2. Create PM2 configuration file `ecosystem.config.js`
```javascript
module.exports = {
  apps: [{
    name: 'luckinhappykami',
    script: 'dist/server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    }
  }]
};
```

3. Start the application with PM2
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### Step 4: Nginx Configuration
1. In Baota panel, go to "Website" â†’ "Settings"
2. Add website configuration or modify existing one
3. Configure reverse proxy:

```
# Nginx Configuration
server {
    listen 80;
    server_name your-domain.com;
    root /www/wwwroot/luckinhappykami/dist/public;
    index index.html;

    # Frontend routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy
    location /api {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Static files
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

4. SSL certificate configuration (recommended)
   - In Baota panel, go to "SSL" â†’ "Let's Encrypt"
   - Apply for free SSL certificate

#### Step 5: Database and File Permissions
1. Ensure SQLite database file has correct permissions
```bash
chmod 644 data/luckinhappykami.db
```

2. Ensure uploads directory has write permissions
```bash
chmod 755 uploads
```

#### Step 6: Firewall Configuration
1. In Baota panel, go to "Security" â†’ "Firewall"
2. Open ports 80, 443 (HTTP/HTTPS)
3. Ensure port 3001 is only accessible locally

#### Step 7: Backup Configuration
1. Set up regular database backups
2. Configure log rotation
3. Set up monitoring alerts

#### Step 8: Testing
1. Access your domain: `http://your-domain.com`
2. Test API endpoints
3. Run the test scripts to verify functionality

#### Troubleshooting
- **Port conflicts**: Check if ports 80, 443, 3001 are available
- **Permission issues**: Ensure proper file permissions
- **Database errors**: Check database file path and permissions
- **Memory issues**: Monitor PM2 logs and adjust memory limits

### ğŸ¤ Contributing

1. Fork the repository
2. Create feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Submit Pull Request

### ğŸ“„ License

This project is licensed under the MIT License. See [LICENSE](LICENSE) file for details.

### â­ Acknowledgments

Special thanks to the original project:
- **[xiaoxiaoguai-yyds/xxgkami](https://github.com/xiaoxiaoguai-yyds/xxgkami)** - Original PHP implementation that inspired this TypeScript rewrite

Thanks to all developers who contributed to this project!

---

**Note**: This project is a complete TypeScript rewrite of the original PHP version, providing better type safety, performance, and development experience.

---

## ä¸­æ–‡

### âœ¨ ç³»ç»Ÿç‰¹ç‚¹

#### ğŸ›¡ï¸ å®‰å…¨å¯é 
- bcryptå¯†ç åŠ å¯†å­˜å‚¨
- JWTèº«ä»½éªŒè¯
- è®¾å¤‡ç»‘å®šæœºåˆ¶
- é˜²æš´åŠ›ç ´è§£
- å¤šé‡å®‰å…¨éªŒè¯
- SHA1åŠ å¯†å¡å¯†å­˜å‚¨

#### ğŸ”Œ APIæ”¯æŒ
- RESTful APIæ¥å£
- å¤šAPIå¯†é’¥ç®¡ç†
- APIè°ƒç”¨ç»Ÿè®¡
- è¯¦ç»†æ¥å£æ–‡æ¡£
- æ”¯æŒPOST/GETéªŒè¯
- è®¾å¤‡IDç»‘å®šæœºåˆ¶

#### âš¡ é«˜æ•ˆç¨³å®š
- TypeScriptç±»å‹å®‰å…¨
- é«˜æ€§èƒ½SQLiteæ•°æ®åº“
- å¿«é€Ÿå“åº”é€Ÿåº¦
- ç¨³å®šè¿è¡Œæ€§èƒ½
- ç°ä»£å¼‚æ­¥å¤„ç†

#### ğŸ“Š æ•°æ®ç»Ÿè®¡
- å®æ—¶ç»Ÿè®¡åŠŸèƒ½
- è¯¦ç»†æ•°æ®åˆ†æ
- å¯è§†åŒ–å›¾è¡¨å±•ç¤º
- APIè°ƒç”¨ç»Ÿè®¡
- å®Œæ•´ä½¿ç”¨è®°å½•

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### é€‰é¡¹1ï¼šè‡ªåŠ¨åŒ–å®‰è£…ï¼ˆæ¨èï¼‰

ä¸ºäº†è·å¾—æœ€ç®€å•çš„è®¾ç½®ä½“éªŒï¼Œè¯·ä½¿ç”¨æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼š

```bash
# 1. ä¸‹è½½æˆ–å…‹éš†é¡¹ç›®
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami

# 2. è¿è¡Œå®‰è£…è„šæœ¬
./install.sh
```

è¯¥è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œï¼š
- âœ… æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
- âœ… è‡ªåŠ¨å®‰è£…ä¾èµ–
- âœ… é…ç½®ç¯å¢ƒå˜é‡
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… æ„å»ºåº”ç”¨ç¨‹åº
- âœ… è®¾ç½®PM2è¿›ç¨‹ç®¡ç†å™¨ï¼ˆå¯é€‰ï¼‰
- âœ… åˆ›å»ºå¯åŠ¨è„šæœ¬

#### é€‰é¡¹2ï¼šæ‰‹åŠ¨å®‰è£…

å¦‚æœæ‚¨åå¥½æ‰‹åŠ¨å®‰è£…ï¼š

##### ç¯å¢ƒè¦æ±‚
```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

##### å®‰è£…æ­¥éª¤

1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è·¯å¾„å’Œå…¶ä»–è®¾ç½®
```

4. åˆå§‹åŒ–æ•°æ®åº“
```bash
npm run init-db
```

5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

6. è®¿é—®åº”ç”¨
```
http://localhost:3000
```

### ğŸ“ é¡¹ç›®ç»“æ„

```
luckinhappykami/
â”œâ”€â”€ src/                          # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ controllers/              # APIæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                   # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ types/                    # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”‚   â”œâ”€â”€ views/                    # æ¨¡æ¿æ–‡ä»¶ï¼ˆå¼€å‘ç”¨ï¼‰
â”‚   â””â”€â”€ server.ts                 # åº”ç”¨å…¥å£
â”œâ”€â”€ frontend/                     # å‰ç«¯Vue.jsåº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/           # Vueç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ stores/               # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils/                # å‰ç«¯å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ types/                # å‰ç«¯ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ public/                   # å‰ç«¯é™æ€èµ„æº
â”‚   â”œâ”€â”€ index.html                # å‰ç«¯å…¥å£HTML
â”‚   â”œâ”€â”€ vite.config.ts            # Viteé…ç½®
â”‚   â””â”€â”€ package.json              # å‰ç«¯ä¾èµ–
â”œâ”€â”€ data/                         # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ uploads/                      # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ dist/                         # ç¼–è¯‘è¾“å‡ºç›®å½•
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ package.json                  # ä¸»é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â””â”€â”€ README.md
```

### ğŸ› ï¸ å¯ç”¨è„šæœ¬

```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§ç‰ˆæœ¬
npm start

# åˆå§‹åŒ–æ•°æ®åº“
npm run init-db

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ£€æŸ¥
npm run lint

# ä»£ç æ ¼å¼åŒ–
npm run format
```

### ğŸ“š APIæ–‡æ¡£

#### å¡å¯†éªŒè¯æ¥å£

##### POST /api/verify
éªŒè¯å¡å¯†å¹¶è¿›è¡Œè®¾å¤‡ç»‘å®š

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "card_key": "å¡å¯†å¯†é’¥",
  "device_id": "è®¾å¤‡å”¯ä¸€æ ‡è¯†"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "éªŒè¯æˆåŠŸ",
  "data": {
    "card_key": "xxx",
    "status": 1,
    "use_time": "2024-01-01 12:00:00",
    "expire_time": "2024-01-31 12:00:00",
    "card_type": "time",
    "duration": 30,
    "device_id": "device123",
    "allow_reverify": true
  }
}
```

#### ç®¡ç†æ¥å£

##### POST /admin/login
ç®¡ç†å‘˜ç™»å½•

##### GET /admin/cards
è·å–å¡å¯†åˆ—è¡¨

##### POST /admin/cards/generate
æ‰¹é‡ç”Ÿæˆå¡å¯†

### ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Express.js
- **ç¼–ç¨‹è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: SQLite3
- **èº«ä»½éªŒè¯**: JWT + bcrypt
- **æ¨¡æ¿å¼•æ“**: EJS
- **å‰ç«¯æ ·å¼**: ç°ä»£åŒ–CSS
- **æ„å»ºå·¥å…·**: TypeScript Compiler
- **ä»£ç è´¨é‡**: ESLint + Prettier

### ğŸ”’ å®‰å…¨ç‰¹æ€§

- **å¯†ç å®‰å…¨**: bcryptå“ˆå¸Œç®—æ³•
- **èº«ä»½éªŒè¯**: JWTä»¤ç‰Œæœºåˆ¶
- **è¾“å…¥éªŒè¯**: å…¨é¢çš„è¾“å…¥ sanitization
- **SQLæ³¨å…¥é˜²æŠ¤**: å‚æ•°åŒ–æŸ¥è¯¢
- **XSSé˜²æŠ¤**: å†…å®¹è½¬ä¹‰å’ŒCSPå¤´

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ä¼˜åŒ–**: æ™ºèƒ½æŸ¥è¯¢åˆå¹¶å’Œç´¢å¼•ä½¿ç”¨
- **ç¼“å­˜ç­–ç•¥**: é™æ€èµ„æºç¼“å­˜å’Œé¢„åŠ è½½
- **å¼‚æ­¥å¤„ç†**: å……åˆ†åˆ©ç”¨Node.jså¼‚æ­¥ç‰¹æ€§
- **å†…å­˜ç®¡ç†**: é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶
- **å“åº”å‹ç¼©**: Gzipå‹ç¼©å‡å°ä¼ è¾“å¤§å°

### ğŸš€ å®å¡”éƒ¨ç½²æŒ‡å—

#### å‰ç½®è¦æ±‚
- å·²å®‰è£…å®å¡”é¢æ¿çš„æœåŠ¡å™¨
- åŸŸåï¼ˆå¯é€‰ï¼‰
- SSHè®¿é—®æƒé™

#### ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨å‡†å¤‡
1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥"è½¯ä»¶å•†åº—" â†’ "è¿è¡Œç¯å¢ƒ"
3. å®‰è£… Node.js 18+ å’Œ PM2
4. å®‰è£… Nginxï¼ˆå¦‚æœªå®‰è£…ï¼‰

#### ç¬¬äºŒæ­¥ï¼šä»£ç éƒ¨ç½²
1. é€šè¿‡FTPä¸Šä¼ é¡¹ç›®æ–‡ä»¶æˆ–ä½¿ç”¨gitå…‹éš†
```bash
cd /www/wwwroot
git clone https://github.com/gaofee/luckinhappykami.git
cd luckinhappykami
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®æ‚¨çš„è®¾ç½®
```

4. åˆå§‹åŒ–æ•°æ®åº“
```bash
npm run init-db
```

5. æ„å»ºåº”ç”¨
```bash
npm run build
```

#### ç¬¬ä¸‰æ­¥ï¼šPM2è¿›ç¨‹ç®¡ç†
1. å®‰è£…PM2ï¼ˆå¦‚å®å¡”æœªå®‰è£…ï¼‰
```bash
npm install -g pm2
```

2. åˆ›å»ºPM2é…ç½®æ–‡ä»¶ `ecosystem.config.js`
```javascript
module.exports = {
  apps: [{
    name: 'luckinhappykami',
    script: 'dist/server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    }
  }]
};
```

3. ä½¿ç”¨PM2å¯åŠ¨åº”ç”¨
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### ç¬¬å››æ­¥ï¼šNginxé…ç½®
1. åœ¨å®å¡”é¢æ¿è¿›å…¥"ç½‘ç«™" â†’ "è®¾ç½®"
2. æ·»åŠ ç½‘ç«™é…ç½®æˆ–ä¿®æ”¹ç°æœ‰é…ç½®
3. é…ç½®åå‘ä»£ç†ï¼š

```
# Nginxé…ç½®
server {
    listen 80;
    server_name your-domain.com;
    root /www/wwwroot/luckinhappykami/dist/public;
    index index.html;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

4. SSLè¯ä¹¦é…ç½®ï¼ˆæ¨èï¼‰
   - åœ¨å®å¡”é¢æ¿è¿›å…¥"SSL" â†’ "Let's Encrypt"
   - ç”³è¯·å…è´¹SSLè¯ä¹¦

#### ç¬¬äº”æ­¥ï¼šæ•°æ®åº“å’Œæ–‡ä»¶æƒé™
1. ç¡®ä¿SQLiteæ•°æ®åº“æ–‡ä»¶æƒé™æ­£ç¡®
```bash
chmod 644 data/luckinhappykami.db
```

2. ç¡®ä¿ä¸Šä¼ ç›®å½•æœ‰å†™å…¥æƒé™
```bash
chmod 755 uploads
```

#### ç¬¬å…­æ­¥ï¼šé˜²ç«å¢™é…ç½®
1. åœ¨å®å¡”é¢æ¿è¿›å…¥"å®‰å…¨" â†’ "é˜²ç«å¢™"
2. å¼€æ”¾80ã€443ç«¯å£ï¼ˆHTTP/HTTPSï¼‰
3. ç¡®ä¿3001ç«¯å£ä»…æœ¬åœ°è®¿é—®

#### ç¬¬ä¸ƒæ­¥ï¼šå¤‡ä»½é…ç½®
1. è®¾ç½®å®šæœŸæ•°æ®åº“å¤‡ä»½
2. é…ç½®æ—¥å¿—è½®è½¬
3. è®¾ç½®ç›‘æ§å‘Šè­¦

#### ç¬¬å…«æ­¥ï¼šæµ‹è¯•éªŒè¯
1. è®¿é—®åŸŸåï¼š`http://your-domain.com`
2. æµ‹è¯•APIæ¥å£
3. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

#### æ•…éšœæ’é™¤
- **ç«¯å£å†²çª**ï¼šæ£€æŸ¥80ã€443ã€3001ç«¯å£æ˜¯å¦å¯ç”¨
- **æƒé™é—®é¢˜**ï¼šç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
- **æ•°æ®åº“é”™è¯¯**ï¼šæ£€æŸ¥æ•°æ®åº“æ–‡ä»¶è·¯å¾„å’Œæƒé™
- **å†…å­˜é—®é¢˜**ï¼šç›‘æ§PM2æ—¥å¿—å¹¶è°ƒæ•´å†…å­˜é™åˆ¶

### ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

### ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ MIT åè®®å¼€æºï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

### â­ è‡´è°¢

ç‰¹åˆ«æ„Ÿè°¢åŸå§‹é¡¹ç›®ï¼š
- **[xiaoxiaoguai-yyds/xxgkami](https://github.com/xiaoxiaoguai-yyds/xxgkami)** - åŸå§‹PHPå®ç°ç‰ˆæœ¬ï¼Œä¸ºæœ¬TypeScripté‡æ„æä¾›äº†çµæ„Ÿ

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

**æ³¨æ„**: æœ¬é¡¹ç›®æ˜¯åŸPHPç‰ˆæœ¬çš„å®Œæ•´TypeScripté‡æ„ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹å®‰å…¨ã€æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚
